<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω H·ªçc Sinh 11A4 - Ultimate V4.8</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; padding: 10px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        .header-section { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #007bff; padding-bottom: 15px; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        h1 { margin: 0; color: #2c3e50; font-size: 24px; }
        
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; display: inline-block; }
        .role-super { background: #6610f2; color: #fff; }
        .role-admin { background: #d1e7dd; color: #0f5132; }
        .role-user { background: #cfe2ff; color: #084298; }
        .role-guest { background: #f8d7da; color: #842029; }

        .stats-bar { display: flex; gap: 15px; background: #e7f1ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #004085; font-weight: 600; flex-wrap: wrap; }
        .stats-item span { color: #dc3545; font-size: 1.2em; margin-left: 5px; }

        .panel { background: #fff3cd; border: 1px solid #ffeeba; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .panel.active { display: block; animation: fadeIn 0.5s; }
        .admin-title { font-weight: bold; margin-bottom: 15px; color: #856404; text-transform: uppercase; border-bottom: 1px solid #ffeeba; padding-bottom: 5px; font-size: 14px; }
        
        .form-group { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
        input, select, textarea { padding: 10px; border: 1px solid #ced4da; border-radius: 6px; width: 100%; box-sizing: border-box; font-size: 14px; outline: none; }
        
        button { cursor: pointer; padding: 10px 15px; border: none; border-radius: 6px; color: white; font-weight: 600; transition: 0.2s; font-size: 14px; }
        .btn-add { background-color: #198754; grid-column: 1 / -1; }
        .btn-edit { background-color: #ffc107; color: #000; font-size: 12px; padding: 5px 8px; }
        .btn-delete { background-color: #dc3545; font-size: 12px; padding: 5px 8px; }
        .btn-reset { background-color: #17a2b8; font-size: 12px; padding: 5px 8px; margin-right: 5px; }
        .btn-save-notice { background-color: #fd7e14; margin-top: 10px; }

        /* GIAO DI·ªÜN NH·∫¨T K√ù */
        .log-section { background: white; border: 1px solid #ddd; border-radius: 6px; overflow: hidden; }
        .log-header { background: #6610f2; color: white; display: grid; grid-template-columns: 120px 150px 1fr; }
        .log-header div { padding: 10px; font-weight: bold; font-size: 12px; text-transform: uppercase; border-right: 1px solid rgba(255,255,255,0.2); }
        .log-body { max-height: 250px; overflow-y: auto; }
        .log-row { display: grid; grid-template-columns: 120px 150px 1fr; border-bottom: 1px solid #eee; }
        .log-row div { padding: 8px 10px; font-size: 12px; border-right: 1px solid #eee; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .log-action { white-space: normal !important; word-break: break-word; line-height: 1.4; border-right: none !important; }

        .table-responsive { overflow-x: auto; border-radius: 8px; box-shadow: 0 0 0 1px #dee2e6; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6; }
        th { background-color: #007bff; color: white; text-transform: uppercase; font-size: 13px; }

        /* MODAL STYLE */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 500px; max-width: 95%; position: relative; animation: popIn 0.3s; box-sizing: border-box; }
        .close-btn { position: absolute; right: 20px; top: 15px; font-size: 28px; cursor: pointer; color: #aaa; }
        .notice-content { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; max-height: 300px; overflow-y: auto; white-space: pre-wrap; margin: 15px 0; line-height: 1.6; }

        /* THANH T√åM KI·∫æM M·ªöI */
        .search-container { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .search-input { flex: 1; max-width: 300px; padding: 10px; border: 2px solid #007bff; border-radius: 6px; }

        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
        @keyframes popIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        @media (max-width: 768px) { .form-group { grid-template-columns: 1fr; } .super-admin-layout { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <h1>üéì Qu·∫£n L√Ω L·ªõp 11A4</h1>
        <div class="admin-controls">
            <span id="userStatus" class="status-badge role-guest">Kh√°ch</span>
            <button id="btnAuth" style="background:#0d6efd" onclick="moFormDangNhap()">üîë ƒêƒÉng nh·∫≠p</button>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stats-item">T·ªïng sƒ© s·ªë: <span id="tongSiSo">0</span></div>
        <div class="stats-item">Nam: <span id="tongNam">0</span> üë¶</div>
        <div class="stats-item">N·ªØ: <span id="tongNu">0</span> üëß</div>
    </div>

    <div id="superAdminPanel" class="panel">
        <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px;" class="super-admin-layout">
            <div>
                <div class="admin-title">üõ°Ô∏è Qu·∫£n l√Ω t√†i kho·∫£n ph·ª•</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1.2fr 80px; gap: 5px; margin-bottom: 10px;">
                    <input type="text" id="newUsername" placeholder="User">
                    <input type="text" id="newPassword" placeholder="Pass">
                    <select id="newRole">
                        <option value="admin">Ph√≥ Admin</option>
                        <option value="user">Th√†nh vi√™n</option>
                    </select>
                    <button style="background:#6610f2" onclick="themTaiKhoan()">T·∫°o</button>
                </div>
                <div class="table-responsive" style="margin-top: 5px;">
                    <table style="min-width: auto; font-size: 12px; margin: 0;">
                        <thead><tr><th>USER</th><th>ROLE (S·ª≠a quy·ªÅn)</th><th style="text-align:center">H√ÄNH ƒê·ªòNG</th></tr></thead>
                        <tbody id="bodyTaiKhoan"></tbody>
                    </table>
                </div>
            </div>

            <div>
                <div class="admin-title">üìú Nh·∫≠t k√Ω ho·∫°t ƒë·ªông (Logs)</div>
                <div class="log-section">
                    <div class="log-header">
                        <div>Th·ªùi gian</div>
                        <div>Ng∆∞·ªùi d√πng</div>
                        <div style="border:none">H√†nh ƒë·ªông</div>
                    </div>
                    <div class="log-body" id="bodyLog"></div>
                </div>
                <button style="background:#dc3545; width: 100%; margin-top: 5px; padding: 10px;" onclick="xoaLog()">üóëÔ∏è X√≥a l·ªãch s·ª≠</button>
            </div>
        </div>
    </div>

    <div id="adminArea" class="panel">
        <div class="admin-title">üõ†Ô∏è Th√™m h·ªçc sinh m·ªõi</div>
        <div class="form-group">
            <input type="text" id="hoTen" placeholder="H·ªç v√† T√™n">
            <select id="gioiTinh"><option value="Nam">Nam</option><option value="N·ªØ">N·ªØ</option></select>
            <input type="text" id="ngaySinh" placeholder="Ng√†y sinh">
            <input type="text" id="sdt" placeholder="S·ªë ƒëi·ªán tho·∫°i">
            <input type="text" id="email" placeholder="Email">
            <input type="text" id="queQuan" placeholder="Qu√™ qu√°n">
            <input type="text" id="diaChi" placeholder="ƒê·ªãa ch·ªâ">
            <button class="btn-add" onclick="themHocSinh()">‚ûï Th√™m H·ªçc Sinh</button>
        </div>

        <div class="admin-title" style="margin-top: 20px;">üì¢ Thay ƒë·ªïi th√¥ng b√°o l·ªõp</div>
        <textarea id="txtNoiDungThongBao" rows="3" placeholder="Vi·∫øt th√¥ng b√°o t·∫°i ƒë√¢y..."></textarea>
        <button class="btn-save-notice" onclick="luuThongBaoMoi()">üíæ L∆∞u Th√¥ng B√°o</button>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" onkeyup="timKiemHocSinh()" placeholder="üîç Nh·∫≠p t√™n h·ªçc sinh ƒë·ªÉ t√¨m ki·∫øm...">
    </div>

    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>STT</th><th>H·ªç T√™n</th><th>Gi·ªõi T√≠nh</th><th>Ng√†y Sinh</th><th>SƒêT</th><th>Email</th><th>Qu√™ Qu√°n</th><th>ƒê·ªãa Ch·ªâ</th><th>H√†nh ƒê·ªông</th>
                </tr>
            </thead>
            <tbody id="thanBang"></tbody>
        </table>
    </div>
</div>

<div id="noticeModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="dongThongBao()">&times;</span>
        <div style="font-size: 20px; font-weight: bold; text-align: center; color: #007bff;">üì¢ TH√îNG B√ÅO L·ªöP 11A4</div>
        <div class="notice-content" id="hienThiNoiDungTB"></div>
        <button style="background:#6c757d; width:100%; padding:12px" onclick="dongThongBao()">ƒê√£ Hi·ªÉu & ƒê√≥ng</button>
    </div>
</div>

<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="dongFormSua()">&times;</span>
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 20px; text-align: center;">üìù S·ª≠a Th√¥ng Tin H·ªçc Sinh</div>
        <input type="hidden" id="editId">
        <div class="modal-input"><label>H·ªç v√† T√™n:</label><input type="text" id="editHoTen"></div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="modal-input"><label>Gi·ªõi T√≠nh:</label><select id="editGioiTinh"><option value="Nam">Nam</option><option value="N·ªØ">N·ªØ</option></select></div>
            <div class="modal-input"><label>Ng√†y Sinh:</label><input type="text" id="editNgaySinh"></div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="modal-input"><label>SƒêT:</label><input type="text" id="editSdt"></div>
            <div class="modal-input"><label>Email:</label><input type="text" id="editEmail"></div>
        </div>
        <div class="modal-input"><label>Qu√™ Qu√°n:</label><input type="text" id="editQueQuan"></div>
        <div class="modal-input"><label>ƒê·ªãa Ch·ªâ:</label><input type="text" id="editDiaChi"></div>
        <button style="background:#ffc107; color:#000; width:100%; padding:12px; font-weight:bold" onclick="luuCapNhatHS()">üíæ L∆ØU THAY ƒê·ªîI</button>
    </div>
</div>

<div id="loginModal" class="modal">
    <div class="modal-content" style="width: 350px;">
        <span class="close-btn" onclick="dongFormDangNhap()">&times;</span>
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 20px; text-align: center;">H·ªá Th·ªëng ƒêƒÉng Nh·∫≠p</div>
        <div class="modal-input"><label>T√™n ƒëƒÉng nh·∫≠p:</label><input type="text" id="loginUser"></div>
        <div class="modal-input"><label>M·∫≠t kh·∫©u:</label><input type="password" id="loginPass"></div>
        <button style="background:#007bff; width:100%; padding:12px" onclick="xuLyDangNhap()">ƒêƒÇNG NH·∫¨P</button>
    </div>
</div>

<script>
    const KEY_STUDENTS = "DS_HS_11A4", KEY_ACCOUNTS = "DS_TK_11A4", KEY_LOGS = "LOG_11A4", KEY_NOTICE = "TB_11A4";
    var currentRole = 'guest', currentUser = 'Kh√°ch', danhSachHocSinh = [], danhSachTaiKhoan = [], danhSachLog = [];

    window.onload = function() {
        danhSachHocSinh = JSON.parse(localStorage.getItem(KEY_STUDENTS)) || [];
        danhSachTaiKhoan = JSON.parse(localStorage.getItem(KEY_ACCOUNTS)) || [];
        danhSachLog = JSON.parse(localStorage.getItem(KEY_LOGS)) || [];
        
        capNhatGiaoDien();
        hienThiHocSinh(); // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã t·∫•t c·∫£
        khoiTaoThongBao();
    };

    // --- CH·ª®C NƒÇNG T√åM KI·∫æM M·ªöI ---
    function timKiemHocSinh() {
        let keyword = document.getElementById("searchInput").value.toLowerCase();
        // L·ªçc danh s√°ch d·ª±a tr√™n t√™n
        let ketQua = danhSachHocSinh.filter(hs => hs.hoTen.toLowerCase().includes(keyword));
        // G·ªçi hi·ªÉn th·ªã v·ªõi danh s√°ch ƒë√£ l·ªçc
        hienThiHocSinh(ketQua);
    }

    // --- QU·∫¢N L√ù TH√îNG B√ÅO ---
    function khoiTaoThongBao() {
        let nd = localStorage.getItem(KEY_NOTICE) || "Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi h·ªá th·ªëng qu·∫£n l√Ω l·ªõp 11A4!";
        document.getElementById("hienThiNoiDungTB").innerText = nd;
        document.getElementById("txtNoiDungThongBao").value = nd;
        document.getElementById("noticeModal").style.display = "flex";
    }

    function luuThongBaoMoi() {
        let nd = document.getElementById("txtNoiDungThongBao").value;
        localStorage.setItem(KEY_NOTICE, nd);
        document.getElementById("hienThiNoiDungTB").innerText = nd;
        ghiLog("Thay ƒë·ªïi th√¥ng b√°o l·ªõp");
        alert("ƒê√£ l∆∞u th√¥ng b√°o m·ªõi!");
    }

    function dongThongBao() { document.getElementById("noticeModal").style.display = "none"; }

    // --- QU·∫¢N L√ù NH·∫¨T K√ù ---
    function ghiLog(action) {
        let now = new Date();
        let timeStr = now.getHours() + ":" + (now.getMinutes()<10?'0':'') + now.getMinutes() + " " + now.getDate() + "/" + (now.getMonth()+1);
        danhSachLog.unshift({ time: timeStr, user: currentUser, action: action });
        localStorage.setItem(KEY_LOGS, JSON.stringify(danhSachLog.slice(0, 50)));
        if(currentRole === 'super_admin') hienThiLog();
    }

    function hienThiLog() {
        let container = document.getElementById("bodyLog"), html = '';
        danhSachLog.forEach(l => {
            html += `<div class="log-row">
                <div class="log-time">${l.time}</div>
                <div class="log-user">${l.user}</div>
                <div class="log-action" style="border:none">${l.action}</div>
            </div>`;
        });
        container.innerHTML = html;
    }

    // --- QU·∫¢N L√ù H·ªåC SINH (ƒê√£ S·ª≠a ƒë·ªÉ h·ªó tr·ª£ t√¨m ki·∫øm) ---
    function hienThiHocSinh(data = danhSachHocSinh) { // M·∫∑c ƒë·ªãnh l√† d√πng danhSachHocSinh n·∫øu kh√¥ng truy·ªÅn v√†o
        let tbody = document.getElementById("thanBang"), html = '';
        let canEdit = (currentRole === 'super_admin' || currentRole === 'admin');
        let canView = (currentRole !== 'guest');

        if(data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="9" style="text-align:center">Kh√¥ng t√¨m th·∫•y h·ªçc sinh n√†o!</td></tr>';
            return;
        }

        data.forEach((hs, i) => {
            html += `<tr>
                <td>${i+1}</td>
                <td><b>${hs.hoTen}</b></td>
                <td style="color:${hs.gioiTinh==='Nam'?'blue':'deeppink'}; font-weight:bold">${hs.gioiTinh}</td>
                <td>${canView ? hs.ngaySinh : '***'}</td>
                <td>${canView ? hs.sdt : '***'}</td>
                <td>${canView ? hs.email : '***'}</td>
                <td>${canView ? hs.queQuan : '***'}</td>
                <td>${canView ? hs.diaChi : '***'}</td>
                <td>${canEdit ? `<button class="btn-edit" onclick="suaHocSinh(${hs.id})">S·ª≠a</button>
                     <button class="btn-delete" onclick="xoaHocSinh(${hs.id})">X√≥a</button>` : '---'}</td>
            </tr>`;
        });
        tbody.innerHTML = html;
        
        // C·∫≠p nh·∫≠t th·ªëng k√™ (v·∫´n ƒë·∫øm tr√™n t·ªïng s·ªë danh s√°ch g·ªëc)
        document.getElementById("tongSiSo").innerText = danhSachHocSinh.length;
        document.getElementById("tongNam").innerText = danhSachHocSinh.filter(h=>h.gioiTinh==='Nam').length;
        document.getElementById("tongNu").innerText = danhSachHocSinh.filter(h=>h.gioiTinh!=='Nam').length;
    }

    function suaHocSinh(id) {
        let hs = danhSachHocSinh.find(h => h.id === id);
        if(!hs) return;
        document.getElementById("editId").value = hs.id;
        document.getElementById("editHoTen").value = hs.hoTen;
        document.getElementById("editGioiTinh").value = hs.gioiTinh;
        document.getElementById("editNgaySinh").value = hs.ngaySinh || '';
        document.getElementById("editSdt").value = hs.sdt || '';
        document.getElementById("editEmail").value = hs.email || '';
        document.getElementById("editQueQuan").value = hs.queQuan || '';
        document.getElementById("editDiaChi").value = hs.diaChi || '';
        document.getElementById("editModal").style.display = "flex";
    }

    function luuCapNhatHS() {
        let id = parseInt(document.getElementById("editId").value);
        let idx = danhSachHocSinh.findIndex(h => h.id === id);
        if(idx !== -1) {
            let cu = {...danhSachHocSinh[idx]};
            let moi = {
                id: id, hoTen: document.getElementById("editHoTen").value,
                gioiTinh: document.getElementById("editGioiTinh").value,
                ngaySinh: document.getElementById("editNgaySinh").value,
                sdt: document.getElementById("editSdt").value,
                email: document.getElementById("editEmail").value,
                queQuan: document.getElementById("editQueQuan").value,
                diaChi: document.getElementById("editDiaChi").value
            };
            let changes = [];
            let labels = { hoTen: "T√™n", gioiTinh: "Ph√°i", ngaySinh: "NS", sdt: "SƒêT", email: "Email", queQuan: "Qu√™", diaChi: "ƒêC" };
            for(let key in labels) { if(cu[key] !== moi[key]) changes.push(`${labels[key]}: ${cu[key]}‚ûî${moi[key]}`); }
            danhSachHocSinh[idx] = moi;
            localStorage.setItem(KEY_STUDENTS, JSON.stringify(danhSachHocSinh));
            ghiLog(changes.length > 0 ? `S·ª≠a HS [${cu.hoTen}]: ${changes.join(" | ")}` : `S·ª≠a HS [${cu.hoTen}]`);
            hienThiHocSinh(); 
            timKiemHocSinh(); // C·∫≠p nh·∫≠t l·∫°i c·∫£ k·∫øt qu·∫£ t√¨m ki·∫øm n·∫øu ƒëang t√¨m
            dongFormSua();
        }
    }

    function themHocSinh() {
        let t = document.getElementById("hoTen").value;
        if(!t) return alert("Nh·∫≠p t√™n!");
        let hs = { id: Date.now(), hoTen: t, gioiTinh: document.getElementById("gioiTinh").value, ngaySinh: document.getElementById("ngaySinh").value, sdt: document.getElementById("sdt").value, email: document.getElementById("email").value, queQuan: document.getElementById("queQuan").value, diaChi: document.getElementById("diaChi").value };
        danhSachHocSinh.push(hs);
        localStorage.setItem(KEY_STUDENTS, JSON.stringify(danhSachHocSinh));
        ghiLog(`Th√™m m·ªõi HS: ${t}`);
        hienThiHocSinh();
        ["hoTen","ngaySinh","sdt","email","queQuan","diaChi"].forEach(id => document.getElementById(id).value = "");
    }

    function xoaHocSinh(id) {
        let hs = danhSachHocSinh.find(h => h.id === id);
        if(confirm(`X√≥a h·ªçc sinh ${hs.hoTen}?`)) {
            danhSachHocSinh = danhSachHocSinh.filter(h => h.id !== id);
            localStorage.setItem(KEY_STUDENTS, JSON.stringify(danhSachHocSinh));
            ghiLog(`X√≥a h·ªçc sinh: ${hs.hoTen}`);
            hienThiHocSinh();
            timKiemHocSinh(); // C·∫≠p nh·∫≠t l·∫°i giao di·ªán
        }
    }

    // --- H·ªÜ TH·ªêNG T√ÄI KHO·∫¢N (S·ª¨A ƒê·ªîI) ---
    function moFormDangNhap() {
        if(currentRole !== 'guest') { 
            if(confirm("ƒêƒÉng xu·∫•t?")) { currentRole = 'guest'; currentUser = 'Kh√°ch'; capNhatGiaoDien(); hienThiHocSinh(); ghiLog("ƒêƒÉng xu·∫•t h·ªá th·ªëng"); }
        } else { document.getElementById("loginModal").style.display = "flex"; }
    }
    function dongFormDangNhap() { document.getElementById("loginModal").style.display = "none"; }
    function dongFormSua() { document.getElementById("editModal").style.display = "none"; }

    function xuLyDangNhap() {
        let u = document.getElementById("loginUser").value, p = document.getElementById("loginPass").value;
        if(u==='admin' && p==='123456') { currentRole = 'super_admin'; currentUser = 'Super Admin'; }
        else {
            let acc = danhSachTaiKhoan.find(a => a.user === u && a.pass === p);
            if(acc) { currentRole = acc.role; currentUser = u; }
            else return alert("Sai t√†i kho·∫£n!");
        }
        dongFormDangNhap(); ghiLog("ƒêƒÉng nh·∫≠p th√†nh c√¥ng"); capNhatGiaoDien(); hienThiHocSinh();
    }

    function capNhatGiaoDien() {
        document.getElementById("superAdminPanel").style.display = (currentRole==='super_admin') ? 'block' : 'none';
        document.getElementById("adminArea").style.display = (currentRole==='super_admin' || currentRole==='admin') ? 'block' : 'none';
        let st = document.getElementById("userStatus");
        st.innerText = (currentRole==='guest') ? 'Kh√°ch' : `${currentUser} (${currentRole})`;
        st.className = "status-badge " + (currentRole==='super_admin'?'role-super':(currentRole==='admin'?'role-admin':(currentRole==='user'?'role-user':'role-guest')));
        document.getElementById("btnAuth").innerText = (currentRole==='guest') ? 'üîë ƒêƒÉng nh·∫≠p' : 'üö™ ƒêƒÉng xu·∫•t';
        if(currentRole === 'super_admin') { hienThiLog(); hienThiTaiKhoan(); }
    }

    function themTaiKhoan() {
        let u = document.getElementById("newUsername").value, p = document.getElementById("newPassword").value, r = document.getElementById("newRole").value;
        if(u && p) {
            danhSachTaiKhoan.push({user: u, pass: p, role: r});
            localStorage.setItem(KEY_ACCOUNTS, JSON.stringify(danhSachTaiKhoan));
            document.getElementById("newUsername").value = ""; document.getElementById("newPassword").value = "";
            hienThiTaiKhoan(); ghiLog(`T·∫°o t√†i kho·∫£n: ${u}`);
        }
    }

    function hienThiTaiKhoan() {
        let h = '';
        danhSachTaiKhoan.forEach((a,i) => {
            // S·ª≠a ph·∫ßn n√†y: Th√™m Select Box ƒë·ªÉ ƒë·ªïi quy·ªÅn tr·ª±c ti·∫øp
            let roleSelect = `
                <select onchange="capNhatQuyen(${i}, this.value)" style="padding: 2px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px; width: auto;">
                    <option value="admin" ${a.role==='admin'?'selected':''}>Ph√≥ Admin</option>
                    <option value="user" ${a.role==='user'?'selected':''}>Th√†nh vi√™n</option>
                </select>
            `;

            h += `<tr>
                <td>${a.user}</td>
                <td>${roleSelect}</td>
                <td style="text-align:center">
                    <button class="btn-reset" onclick="doiPassTK(${i})">ƒê·ªïi Pass</button>
                    <button class="btn-delete" onclick="xoaTK(${i})">X√≥a</button>
                </td>
            </tr>`;
        });
        document.getElementById("bodyTaiKhoan").innerHTML = h;
    }

    // CH·ª®C NƒÇNG M·ªöI: C·∫¨P NH·∫¨T QUY·ªÄN
    function capNhatQuyen(idx, newRole) {
        let u = danhSachTaiKhoan[idx].user;
        danhSachTaiKhoan[idx].role = newRole;
        localStorage.setItem(KEY_ACCOUNTS, JSON.stringify(danhSachTaiKhoan));
        ghiLog(`ƒê·ªïi quy·ªÅn [${u}] th√†nh: ${newRole}`);
        // Kh√¥ng c·∫ßn alert ƒë·ªÉ tr·∫£i nghi·ªám m∆∞·ª£t m√† h∆°n
    }

    function doiPassTK(idx) {
        let newPass = prompt(`Nh·∫≠p m·∫≠t kh·∫©u m·ªõi cho [${danhSachTaiKhoan[idx].user}]:`);
        if(newPass) {
            danhSachTaiKhoan[idx].pass = newPass;
            localStorage.setItem(KEY_ACCOUNTS, JSON.stringify(danhSachTaiKhoan));
            ghiLog(`ƒê·ªïi m·∫≠t kh·∫©u: ${danhSachTaiKhoan[idx].user}`);
            alert("ƒê√£ ƒë·ªïi m·∫≠t kh·∫©u!");
        }
    }

    function xoaTK(i) { 
        if(confirm("X√≥a t√†i kho·∫£n n√†y?")) {
            ghiLog(`X√≥a t√†i kho·∫£n: ${danhSachTaiKhoan[i].user}`);
            danhSachTaiKhoan.splice(i,1); 
            localStorage.setItem(KEY_ACCOUNTS, JSON.stringify(danhSachTaiKhoan)); 
            hienThiTaiKhoan(); 
        }
    }

    function xoaLog() { if(confirm("X√≥a l·ªãch s·ª≠?")) { danhSachLog = []; localStorage.setItem(KEY_LOGS, "[]"); hienThiLog(); } }
</script>
</body>
</html>
